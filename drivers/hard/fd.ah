;-------------------------------------------------------------------------------
;  fd.ah - definitions for FRESD driver.
;-------------------------------------------------------------------------------

; Floppy drive physical parameters structure
struc tFDphysParm
.Max_DTR	RESD	1			; Step rate, usec
.HLST		RESD	1			; Head load/settle time, msec
.HUT		RESD	1			; Head unload time
.SRT		RESD	1			; Step rate, usec

.Spinup		RESD	1			; Time needed for spinup (in jiffies)
.Spindown	RESD	1			; Timeout needed for spindown
.SpindownOfs	RESB	1			; Decides in which position the disk will stop

.SelectDelay	RESB	1			; Delay to wait after select
.RPS		RESB	1			; Rotations per second
.Tracks		RESB	1			; Maximum number of tracks
.Timeout	RESD	1			; Timeout for interrupt requests

.InterleaveSect	RESB	1			; If there are more sectors, use interleave
.Flags		RESB	1			; Various flags
.CheckFreq	RESW	1			; How often should the drive be checked for disk changes
.NativeFormat	RESW	1			; Native format of this drive
endstruc

; Structure described different floppy media formats
struc tMediaFmt
.Sz		RESW	1			; Size in KB
.SPT		RESW	1			; Sectors per track
.Heads		RESW	1			; Number of heads
.Tracks		RESW	1			; Number of tracks
.Strecth	RESW	1			; !=0 means double track steps
.GAP		RESB	1			; GAP1 size
.Rate		RESB	1			; Data rate. |= 0x40 for perpendicular
.Spec1		RESB	1			; Stepping rate, head unload time
.GAP2		RESB	1			; GAP1 size
endstruc

; FD control register bits
%define	FD_Drive0		0
%define	FD_Drive1		1
%define	FD_EnbCTL		4
%define	FD_EnbDMAIRQ		8
%define	FD_Motor0ON		16
%define	FD_Motor1ON		32

; FD status register bits
%define	FDst_Busy0		1
%define	FDst_Busy1		2
%define	FDst_CTLBusy		16
%define	FDst_NoDMA		32
%define	FDst_Direct2CPU		64
%define	FDst_Ready		128

; FDC (chip) commands
%define	FDCcmd_Specify		3			; Specify
%define	FDCcmd_GetST3		4			; Get ST3
%define	FDCcmd_Recalibrate	7			; Recalibrate drive
%define	FDCcmd_Sense		8			; Get status after int
%define	FDCcmd_DumpRegs		0Eh			; Dump registers
%define	FDCcmd_Seek		0Fh			; Seek track
%define	FDCcmd_Version		10h			; Get version code
%define	FDCcmd_Perpendicular	12h			; Perpendicular r/w mode
%define	FDCcmd_Configure	13h			; Configure FIFO operation
%define	FDCcmd_Unlock		14h			; FIFO config unlock
%define	FDCcmd_ReadSecId	4Ah			; Read sector identity
%define	FDCcmd_Format		4Dh			; Format one track
%define	FDCcmd_RSeekOut		8Fh			; Seek out
%define	FDCcmd_Lock		94h			; FIFO config lock
%define	FDCcmd_Write		0C5h			; Write with MT, MFM
%define	FDCcmd_RSeekOut		0CFh			; Seek in
%define	FDCcmd_Read		0E6h			; Read with MT, MFM, SKip deleted

; AT FD parameters register bits
%define	FDATpar_Speed500	0
%define	FDATpar_Speed300	1
%define	FDATpar_Speed250	2
%define	FDATpar_Speed1000	3
%define	FDATpar_WrPrecomp1	4
%define	FDATpar_WrPrecomp2	8
%define	FDATpar_WrPrecomp3	16
%define	FDATpar_ExtFilter	32
%define	FDATpar_PowerOFF	64
%define	FDATpar_Reset		128

; AT diagnostic register bits
%define	FDATst_PosCodeDrv0	1
%define	FDATst_PosCodeDrv0	2
%define	FDATst_PosCodeHead0	4
%define	FDATst_PosCodeHead1	8
%define	FDATst_PosCodeHead2	16
%define	FDATst_PosCodeHead3	32
%define	FDATst_Write		64
%define	FDATst_DiskChanged	128


; Status registers (returned as result of operation)
%define	FDCST0			0
%define	FDCST1			1
%define	FDCST2			3
%define	FDCST3			0			; Return by GetStatus
%define	ST_Cyl			3
%define	ST_Head			4
%define	ST_Sec			5
%define	ST_PCN			1

; ST0 bits
%define	ST0_Bits		0F8h
%define	ST0_Trans		0
%define	ST0_Seek		20h

; ST1 bits
%define	ST1_BadSector		5
%define	ST1_WriteProtect	2

; ST2 bits
%define	ST2_BadCyl		1Fh

; ST3 bits
%define	ST3_Fault		80h
%define	ST3_WrProtect		40h
%define	ST3_Ready		20h

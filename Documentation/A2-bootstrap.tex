% The Radiant Operating System (RadiOS)
% Copyright (c) 2002 RET & COM Research.
% This file is a LaTeX document.

\section{RadiOS bootstrap process}

Ядро операционной системы RadiOS соответствует спецификации Multiboot. Это
значит, что оно может быть загружено и запущено с помощью Multiboot
Compilant Loader, например, загрузчика GRUB (http://www.gnu.org/software/grub).

Сборка ядра, соответствующего спецификации Multiboot, осуществляестя с
помощью редактора связей (компоновщика) ldrdf следующим образом:

ldrdf -xe -s -mbh -o main.rdx <Objects> <-lLibraries>

Опция -mbh указывает, что в начале целевого файла (main.rdx) необходимо создать
специальную запись Multiboot-kludge, идентифицирующую образ ядра, который
загружается в память Multiboot-загрузчиком. Одновременно в запись
Multiboot-kludge интегрируется короткий код, перемещающий настроечную часть
ядра (setup) в ее рабочую область.

Процедура загрузки ядра RadiOS происходит следующим образом:

\begin{enumerate}
\item Программа начальной загрузки (GRUB) загружает из файловой системы
      файл ядра в память. Адрес загрузки определяется значением, сохраненным
      в записи Multiboot-kludge. По умолчанию, при сборке ядра компоновщиком
      ldrdf он устанавливается в 0110000h (если опцией -mbh не задан другой
      адрес)
\item Управление передается в точку старта, также определяемую из записи
      Multiboot-kludge. Это значение всегда равно адресу загрузки + 030h.
      Код, записанный в этой области, перемещает блок настроечной части
      ядра (setup) размером в 4096 байт, находящийся в самом конце образа
      ядра, в рабочую область и передает ему управление
\item Setup приступает к инициализации структур данных ядра, построению
      таблиц системных вызовов и настройке ядра на абсолютные адреса в
      памяти. Этапы следующие:
      \begin{itemize}
      	\item Инициализируется область "системных переменных" setup,
	      начинающаяся с адреса 0700h. В этой области хранятся
	      адреса таблиц системных вызовов, размеры памяти и некоторые
	      другие важные параметры (см. далее)
	\item Если программой начальной загрузки была проинициализирована
	      расширенная карта памяти BIOS (функция 0E820h прерывания Int 15h),
	      то она копируется по адресу 02000h
	\item Если вметсе с ядром в память были загружены дополнительные модули,
	      то информация о них копируется в таблицу, начинающуюся с 01000h,
	      а символьные строки параметров модулей - в буфер по адресу 01200h
	      (всего может быть загружено до 16 модулей)
	\item Область таблицы начальной конфигурации (Startup Configuration
	      Table), сформированная во время компиляции ядра, перемещается
	      по адресу 0500h
	\item Кодовая секция ядра (.text) перемещается в рабочее пространство
	      в "нижней" памяти (по адресу 04000h)
	\item Секция данных (.data) помещается сразу за кодовой, по адресу,
	      выравненному на границу параграфа (16 байт)
	\item Производится настройка всех адресов в загруженном ядре на
	      новые (абсолютные) адреса в памяти. Это осуществляется с помощью
	      настроечных записей (relocation records), помещенных в RDM-файл.
	      Затем инициализируется нулями область BSS (.bss), которая
	      следует сразу же за секцией данных.
	\item
      \end{itemize}
\end{enumerate}


\subsection{BTL - boot time module linker}

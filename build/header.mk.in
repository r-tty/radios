
# Cancel all built-in rules
% : %

# Control variables
SUFFIXES = .nasm .rdm .rdx .bin

# Rule to make RDM from NASM source
%.rdm : %.nasm macros/sugar.ah
	@echo Assembling $<
	@$(AS) $(ASFLAGS) -o $(OBJPATH)/$@ $<
	
# Rule to compile C source
%.rdm : %.c
	@echo Compiling $<
	@$(CC) -o $(OBJPATH)/$@ $<
	
# Paths
RADIOSPATH = @@RADIOSPATH@@
INCLPATH = @@INCLPATH@@
OBJPATH = @@OBJPATH@@
LIBPATH = @@LIBPATH@@
INSTALLPATH = @@INSTALLPATH@@

vpath %.ah $(INCLPATH)
vpath %.bin $(OBJPATH)
vpath %.rdm $(OBJPATH)
vpath %.rdl $(LIBPATH)
vpath %.rdo $(LIBPATH)

# Commands
AS = nasm -w+orphan-labels -f rdf
CC = rncc
LD = ldrdf
AR = rdflib

# Command flags
ifdef DEBUG
 ASFLAGS = -DDEBUG -I$(INCLPATH)/ -Pmacros/sugar.ah -s
 CFLAGS = -N -I$(INCLPATH)/c -c -DDEBUG -g
else
 ASFLAGS = -I$(INCLPATH)/ -Pmacros/sugar.ah -s
 CFLAGS = -N -I$(INCLPATH)/c -c
endif
LDFLAGS = -2 -xe -s -j $(OBJPATH)/ -L $(LIBPATH)/

# Command to generate dependencies file
GENDEPS = ndepgen -M


# Cancel all built-in rules
% : %

# Control variables
SUFFIXES = .nasm .rdm .rdx

# Rule to make RDM from NASM source
%.rdm : %.nasm
	@echo Assembling $<
	@$(AS) $(ASFLAGS) $(OUTPATH)/$@ $<
	
# Rule to compile C source
%.rdm : %.c
	@echo Compiling $<
	@$(CC) -o $(OUPATH)/$@ $<
	
# Paths
RADIOSPATH = @@RADIOSPATH@@
INCLPATH = @@INCLPATH@@
OUTPATH = @@OBJPATH@@
INSTALLPATH = @@INSTALLPATH@@

vpath %.ah $(INCLPATH)
vpath %.rdm $(OUTPATH)
vpath %.rdl $(OUTPATH)
vpath %.bin $(OUTPATH)

# Commands
AS = nasm
CC = rncc
LD = ldrdf
AR = rdflib

# Command flags
ifdef DEBUG
 ASFLAGS = -DDEBUG -f rdf -I$(INCLPATH)/ -Pmacros/sugar.ah -s -o
 CFLAGS = -N -I$(INCLPATH)/c -c -DDEBUG -g
else
 ASFLAGS = -f rdf -I$(INCLPATH)/ -Pmacros/sugar.ah -s -o
 CFLAGS = -N -I$(INCLPATH)/c -c
endif
LDFLAGS = -2 -xe -s -mbh -j $(OUTPATH)/ -L $(OUTPATH)/ -o main.rdx

# Command to generate dependencies file
GENDEPS = ndepgen -M

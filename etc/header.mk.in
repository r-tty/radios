
# Cancel all built-in rules
% : %

# Control variables
SUFFIXES = .as .rdm .rdx

# Rule to make RDM from NASM source
%.rdm : %.as
	@echo Assembling $<
	@$(AS) $(ASFLAGS) $(OUTPATH)/$@ $<
	
# Paths
RADIOSPATH = @@RADIOSPATH@@
STDINCLPATH = @@STDINCLPATH@@
INCLPATH = @@INCLPATH@@
OUTPATH = @@OBJPATH@@
INSTALLPATH = @@INSTALLPATH@@

vpath %.ah $(INCLPATH)
vpath %.rdm $(OUTPATH)
vpath %.rdl $(OUTPATH)
vpath %.bin $(OUTPATH)

# Commands
AS = nasm
LD = ldrdf
AR = rdflib

# Command flags
ifdef DEBUG
ASFLAGS = -O1 -DDEBUG -f rdf -p$(STDINCLPATH)/tasmlike.ah -i$(INCLPATH)/ -s -o
else
ASFLAGS = -f rdf -p$(STDINCLPATH)/tasmlike.ah -i$(INCLPATH)/ -s -o
endif
LDFLAGS = -2 -xe -s -mbh -j $(OUTPATH)/ -L $(OUTPATH)/ -o main.rdx

# Command to generate dependencies file
GENDEPS = ndepgen -M
